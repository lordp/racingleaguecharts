<h1><%= @league.name %></h1>

<h2>Drivers Championship</h2>
<table class="table table-bordered table-condensed">
  <thead>
    <tr>
      <th>Pos.</th>
      <th>Team</th>
      <th>Name</th>
      <th>Points</th>
      <% @league.races.each do |race| %>
      <th><%= race.short_name %></th>
      <% end %>
      <th>Split</th>
    </tr>
  </thead>
  <tbody>
    <% @league.drivers.sort { |a,b| a.points <=> b.points }.reverse.to_enum.with_index(1).each do |driver, index| %>
    <tr>
      <td><%= index %></td>
      <td><%= driver.team_name %></td>
      <td><%= driver.name %></td>
      <td><%= driver.points %></td>
      <% @league.races.each do |race| %>
        <%= driver_race_result(driver, race) %>
      <% end %>
      <td>?</td>
    </tr>
    <% end %>
  </tbody>
</table>

<h2>Constructors Championship</h2>
<table class="table table-bordered table-condensed">
  <thead>
    <tr>
      <th>Pos.</th>
      <th>Name</th>
      <th>Points</th>
      <% @league.races.each do |race| %>
      <th><%= race.short_name %></th>
      <% end %>
      <th>Split</th>
    </tr>
  </thead>
  <tbody>
    <% @league.teams.sort { |a,b| a.points(@league.id) <=> b.points(@league.id) }.reverse.to_enum.with_index(1).each do |team, index| %>
    <tr>
      <td><%= index %></td>
      <td><%= team.name %></td>
      <td><%= team.points(@league.id) %></td>
      <% @league.races.each do |race| %>
        <td><% cache "team_#{team.id}_race_#{race.id}" do %><%= team_race_points(team, race) %><% end %></td>
      <% end %>
      <td>?</td>
    </tr>
    <% end %>
  </tbody>
</table>
